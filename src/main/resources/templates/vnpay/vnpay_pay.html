<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Tạo mới đơn hàng</title>
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet"/>
    <script th:src="@{/js/jquery.min.js}"></script>
    <link rel="apple-touch-icon" sizes="180x180" th:href="@{/favicon/apple-touch-icon.png}">
    <link rel="icon" type="image/png" sizes="32x32" th:href="@{/favicon/favicon-32x32.png}">
    <link rel="icon" type="image/png" sizes="16x16" th:href="@{/favicon/favicon-16x16.png}">
    <link rel="manifest" th:href="@{/favicon/site.webmanifest}">
    <link rel="icon" type="image/x-icon" th:href="@{/favicon/favicon.ico}">
</head>
<body>
<div class="container">
    <h3>VNPAY DEMO</h3>
    <h4>Tạo mới đơn hàng</h4>

    <form id="frmCreateOrder" th:action="@{/api/payment/create}" method="post">
        <div class="form-group">
            <label>Số tiền</label>
            <input class="form-control" name="amount" type="number" min="1" max="100000000" value="10000"/>
        </div>

        <div class="form-group">
            <h5>Chọn phương thức thanh toán</h5>
            <input type="radio" name="bankCode" value="" checked/> Cổng VNPAY <br/>
            <input type="radio" name="bankCode" value="VNPAYQR"/> VNPAYQR <br/>
            <input type="radio" name="bankCode" value="VNBANK"/> ATM <br/>
            <input type="radio" name="bankCode" value="INTCARD"/> Thẻ quốc tế <br/>
        </div>

        <div class="form-group">
            <h5>Ngôn ngữ giao diện:</h5>
            <input type="radio" name="language" value="vn" checked/> Tiếng Việt
            <input type="radio" name="language" value="en"/> English
        </div>

        <button type="submit" class="btn btn-primary">Thanh toán</button>
    </form>
</div>

<script src="https://pay.vnpay.vn/lib/vnpay/vnpay.min.js"></script>
<script>
    $("#frmCreateOrder").submit(function () {
        var postData = $(this).serialize();
        var submitUrl = $(this).attr("action");
        $.ajax({
            type: "POST",
            url: submitUrl,
            data: postData,
            dataType: "json",
            success: function (x) {
                if (x.code === '00') {
                    if (window.vnpay) {
                        vnpay.open({width: 768, height: 600, url: x.data});
                    } else {
                        window.location.href = x.data;
                    }
                } else {
                    alert("Lỗi: " + x.message);
                }
            }
        });
        return false;
    });
</script>
</body>
</html>
