<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <title layout:title-pattern="CONTENT_TITLE - DECORATOR_TITLE">Movie Detail</title>
    <link rel="stylesheet" th:href="@{/css/layout/layout.css}">
    <link rel="stylesheet" th:href="@{/css/movieDetails.css}">
    <link rel="apple-touch-icon" sizes="180x180" th:href="@{/favicon/apple-touch-icon.png}">
    <link rel="icon" type="image/png" sizes="32x32" th:href="@{/favicon/favicon-32x32.png}">
    <link rel="icon" type="image/png" sizes="16x16" th:href="@{/favicon/favicon-16x16.png}">
    <link rel="manifest" th:href="@{/favicon/site.webmanifest}">
    <link rel="icon" type="image/x-icon" th:href="@{/favicon/favicon.ico}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script th:src="@{/js/translations.js}"></script>
    <script th:src="@{/js/language.js}"></script>
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>

<main layout:fragment="content" class="container py-5">
    <section class="movie-detail-section">
        <div class="row">
            <div class="col-md-4">
                <img th:src="${movie.largeImageUrl}" th:alt="${movie.movieNameVn} + ' Poster'" onerror="this.src='/images/placeholder.jpg'" class="movie-poster">
            </div>
            <div class="col-md-8">
                <h1 class="movie-title" th:text="${movie.movieNameVn}">Vietnamese Title</h1>
                <p class="text-muted" th:text="${movie.movieNameEn}">English Title</p>
                <div class="movie-meta mb-3">
                    <span><i class="bi bi-clock me-1" th:text="${movie.duration} + ' phút'"></i></span>
                    <span><i class="bi bi-calendar-event me-1" th:text="${#temporals.format(movie.fromDate, 'dd/MM/yyyy')}"></i></span>
                </div>

                <p><strong>Thể Loại:</strong>
                    <span th:if="${!#lists.isEmpty(movie.genres)}">
                        <span th:each="genre, iterStat : ${movie.genres}"
                              th:text="${genre} + (${iterStat.last} ? '' : ', ')"></span>
                    </span>
                    <span th:unless="${!#lists.isEmpty(movie.genres)}">Chưa xác định</span>
                </p>

                <p><strong>Đạo Diễn: </strong>
                    <span th:text="${movie.director} ?: 'Chưa xác định'"></span>
                </p>

                <p><strong>Diễn Viên: </strong>
                    <span th:text="${movie.actor} ?: 'Chưa xác định'"></span>
                </p>

                <p><strong>Ngôn Ngữ:</strong>
                    <span th:if="${!#lists.isEmpty(movie.versions)}">
                        <span th:each="ver, iterStat : ${movie.versions}"
                              th:text="${ver.versionName} + (${iterStat.last} ? '' : ', ')"></span>
                    </span>
                    <span th:unless="${!#lists.isEmpty(movie.versions)}">Chưa xác định</span>
                </p>

                <p><strong>Phân Loại Độ Tuổi: </strong>
                    <span th:text="${movie.ratingCode} ?: 'Chưa xác định'"></span>
                </p>

                <h3 class="mt-4">Nội Dung Phim: </h3>
                <p th:text="${movie.content}"></p>
            </div>
        </div>

        <div class="text-center mt-4">
            <a href="#" class="btn btn-danger px-4 py-2 fw-bold shadow" style="font-size: 1.1rem;"
               data-bs-toggle="modal" data-bs-target="#bookingModal" data-movie-id="2">
                <i class="bi bi-ticket-perforated"></i> Suất Chiếu
            </a>

            <a href="#" class="btn btn-warning px-4 py-2 fw-bold shadow" style="font-size: 1.1rem; color: #7c4700;"
               data-bs-toggle="modal" data-bs-target="#trailerModal" th:if="${movie.trailerUrl}">
                <i class="bi bi-play-circle"></i> Xem Trailer
            </a>
        </div>

        <!-- Trailer Modal -->
        <div class="modal fade" id="trailerModal" tabindex="-1" aria-labelledby="trailerModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="trailerModalLabel" th:text="${movie.movieNameVn} + ' - Trailer'"></h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="ratio ratio-16x9">
                            <iframe th:src="${movie.trailerUrl}" title="Trailer" allowfullscreen></iframe>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>
<div th:replace="~{fragments/footer :: footer}"></div>
<div th:replace="~{fragments/showtime-modal :: showtimeModal}"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<!--<script th:inline="javascript">-->
<!--    document.addEventListener("DOMContentLoaded", () => {-->
<!--        const versions = /*[[${movie.versions}]]*/ [];-->
<!--        const dateButtonsContainer = document.getElementById("dateButtons");-->
<!--        const showtimeBlocksContainer = document.getElementById("showtimeBlocks");-->
<!--        const versionButtons = document.querySelectorAll(".version-btn");-->
<!--        const locationButtons = document.querySelectorAll(".location-btn");-->
<!--        const inputVersion = document.getElementById("selectedVersionId");-->
<!--        const inputShowtime = document.getElementById("selectedShowtimeId");-->
<!--        const inputVersionForm = document.getElementById("selectedVersionIdInput");-->
<!--        const inputShowtimeForm = document.getElementById("selectedShowtimeIdInput");-->
<!--        const bookNowBtn = document.getElementById("bookNowBtn");-->

<!--        let selectedVersionId = null;-->
<!--        let selectedLocation = null;-->

<!--        // Function to populate dates and showtimes-->
<!--        function populateDatesAndShowtimes(versionId) {-->
<!--            const version = versions.find(v => v.versionId == versionId);-->
<!--            if (!version) return;-->

<!--            // Clear existing buttons and blocks-->
<!--            dateButtonsContainer.innerHTML = "";-->
<!--            showtimeBlocksContainer.innerHTML = "";-->

<!--            // Populate date buttons-->
<!--            version.showDates.forEach(date => {-->
<!--                const btn = document.createElement("button");-->
<!--                btn.className = "btn btn-outline-primary date-btn";-->
<!--                btn.setAttribute("data-date-id", date.showDateId);-->
<!--                btn.textContent = new Date(date.showDate).toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit' });-->
<!--                dateButtonsContainer.appendChild(btn);-->
<!--            });-->

<!--            // Populate showtime blocks-->
<!--            version.showDates.forEach(date => {-->
<!--                const block = document.createElement("div");-->
<!--                block.className = "cinema-block mb-2 showtime-block";-->
<!--                block.setAttribute("data-date-id", date.showDateId);-->
<!--                block.style.display = "none";-->

<!--                const showtimeContainer = document.createElement("div");-->
<!--                showtimeContainer.className = "d-flex gap-2 mt-1 flex-wrap";-->

<!--                date.schedules.forEach(schedule => {-->
<!--                    if (schedule.availableSeats > 0) {-->
<!--                        const btn = document.createElement("button");-->
<!--                        btn.className = "btn btn-outline-success time-btn";-->
<!--                        btn.setAttribute("data-showtime-id", schedule.showtimeId);-->
<!--                        btn.textContent = schedule.scheduleTime+ " (" + schedule.roomNumber + ")" ;-->
<!--                        showtimeContainer.appendChild(btn);-->
<!--                    }-->
<!--                });-->

<!--                block.appendChild(showtimeContainer);-->
<!--                showtimeBlocksContainer.appendChild(block);-->
<!--            });-->

<!--            // Attach event listeners to new date buttons-->
<!--            const dateButtons = document.querySelectorAll(".date-btn");-->
<!--            dateButtons.forEach(button => {-->
<!--                button.addEventListener("click", () => {-->
<!--                    dateButtons.forEach(btn => btn.classList.remove("active"));-->
<!--                    button.classList.add("active");-->

<!--                    const selectedDateId = button.getAttribute("data-date-id");-->
<!--                    document.querySelectorAll(".showtime-block").forEach(block => {-->
<!--                        block.style.display = block.getAttribute("data-date-id") === selectedDateId ? "block" : "none";-->
<!--                    });-->

<!--                    // Reset showtime selection-->
<!--                    inputShowtime.value = "";-->
<!--                    inputShowtimeForm.value = "";-->
<!--                    document.querySelectorAll(".time-btn").forEach(btn => btn.classList.remove("active"));-->
<!--                    bookNowBtn.disabled = true;-->
<!--                });-->
<!--            });-->

<!--            // Auto-select first date if available-->
<!--            if (dateButtons.length > 0) dateButtons[0].click();-->
<!--        }-->

<!--        // Handle version selection-->
<!--        versionButtons.forEach(button => {-->
<!--            button.addEventListener("click", () => {-->
<!--                versionButtons.forEach(btn => btn.classList.remove("active"));-->
<!--                button.classList.add("active");-->

<!--                selectedVersionId = button.getAttribute("data-version-id");-->
<!--                inputVersion.value = selectedVersionId;-->
<!--                inputVersionForm.value = selectedVersionId;-->
<!--                console.log("Chọn versionId:", selectedVersionId);-->

<!--                populateDatesAndShowtimes(selectedVersionId);-->
<!--            });-->
<!--        });-->

<!--        // Handle location selection-->
<!--        locationButtons.forEach(button => {-->
<!--            button.addEventListener("click", () => {-->
<!--                locationButtons.forEach(btn => btn.classList.remove("active"));-->
<!--                button.classList.add("active");-->
<!--                selectedLocation = button.getAttribute("data-location");-->
<!--                console.log("Chọn khu vực:", selectedLocation);-->
<!--                updateBookNowButton();-->
<!--            });-->
<!--        });-->

<!--        // Handle showtime selection-->
<!--        showtimeBlocksContainer.addEventListener("click", e => {-->
<!--            if (e.target.classList.contains("time-btn")) {-->
<!--                document.querySelectorAll(".time-btn").forEach(btn => btn.classList.remove("active"));-->
<!--                e.target.classList.add("active");-->

<!--                const showtimeId = e.target.getAttribute("data-showtime-id");-->
<!--                inputShowtime.value = showtimeId;-->
<!--                inputShowtimeForm.value = showtimeId;-->
<!--                console.log("Chọn showtimeId:", showtimeId);-->
<!--                updateBookNowButton();-->
<!--            }-->
<!--        });-->

<!--        // Enable/disable book now button-->
<!--        function updateBookNowButton() {-->
<!--            bookNowBtn.disabled = !(selectedVersionId && inputShowtime.value && selectedLocation);-->
<!--        }-->

<!--        // Auto-select first version if available-->
<!--        if (versionButtons.length > 0) {-->
<!--            versionButtons[0].click();-->
<!--        }-->
<!--    });-->
<!--</script>-->
<script th:src="@{/js/showtime-modal.js}"></script>

</body>
</html>
