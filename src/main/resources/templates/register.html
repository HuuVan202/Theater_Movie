<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head>
    <meta charset="UTF-8">
    <title layout:title-pattern="$CONTENT_TITLE - $DECORATOR_TITLE">Hệ thống</title>
    <link rel="stylesheet" th:href="@{/css/layout/layout.css}">
    <link rel="stylesheet" th:href="@{/css/login.css}">
    <link rel="stylesheet" th:href="@{/css/validateRegister.css}">
    <link rel="apple-touch-icon" sizes="180x180" th:href="@{/favicon/apple-touch-icon.png}">
    <link rel="icon" type="image/png" sizes="32x32" th:href="@{/favicon/favicon-32x32.png}">
    <link rel="icon" type="image/png" sizes="16x16" th:href="@{/favicon/favicon-16x16.png}">
    <link rel="manifest" th:href="@{/favicon/site.webmanifest}">
    <link rel="icon" type="image/x-icon" th:href="@{/favicon/favicon.ico}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        div.password-group {
            display: flex;
            align-items: center;
            background-color: #1a263a;
            border: 1px solid #2c3e50;
            border-radius: 4px;
            padding: 5px;
            width: 100%;
        }

        div.password-group button {
            background: none;
            border: none;
            color: #f39c12;
            cursor: pointer;
            padding: 5px;
            font-size: 16px;
        }
    </style>
</head>

<body>
<div class="floating-lanterns">
    <div class="lantern"></div>
    <div class="lantern"></div>
    <div class="lantern"></div>
    <div class="lantern"></div>
    <div class="lantern"></div>
    <div class="lantern"></div>
    <div class="lantern"></div>
    <div class="lantern"></div>
</div>
<div th:replace="fragments/header :: header"></div>

<main layout:fragment="content">
    <section class="auth-container">
        <div class="form-block active" id="register">
            <form th:action="@{/register}" method="post" th:object="${registerDTO}">
                <label>Username<span class="error">*</span></label>
                <input type="text" placeholder="Nguyễn Văn A" th:field="*{username}"/>
                <div class="error" th:if="${#fields.hasErrors('username')}" th:errors="*{username}"
                     id="server-error-username"></div>
                <div id="pattern-error" class="error" style="display: none;">✗ Username must contain only letters,
                    numbers, and underscores
                </div>
                <div id="size-error" class="error" style="display: none;">✗ Username must be between 3 and 50
                    characters
                </div>

                <label>Mật khẩu<span class="error">*</span></label>
                <div class="password-group">
                    <input type="password" id="password" placeholder="******" th:field="*{password}"/>
                    <button type="button" id="togglePassword"><i class="fas fa-eye"></i></button>
                </div>
                <div class="error" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"
                     id="server-error-password"></div>
                <div id="validation-messages" class="validation-container"></div>

                <label>Xác nhận mật khẩu<span class="error">*</span></label>
                <div class="password-group">
                    <input type="password" id="passwordConfirm" placeholder="******" th:field="*{passwordConfirm}"/>
                    <button type="button" id="togglePasswordConfirm"><i class="fas fa-eye"></i></button>
                </div>
                <div class="error" th:if="${#fields.hasErrors('passwordConfirm')}" th:errors="*{passwordConfirm}"></div>
                <div id="checkMatch" class="error"></div>
                <label>Email<span class="error">*</span></label>
                <input type="email" placeholder="example@email.com" th:field="*{email}"/>
                <div class="error" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>

                <div class="form-options">
                    <label class="remember-me">
                        <input type="checkbox" id="terms-checkbox"/>
                        <a th:href="@{/terms}">Tôi đồng ý với điều khoản</a>
                    </label>
                </div>

                <button class="submit-btn" type="submit">Đăng Ký</button>
            </form>
        </div>
    </section>
</main>

<div th:replace="fragments/footer :: footer"></div>

<script th:src="@{/js/validationRegister.js}"></script>

<script>
    function togglePassword() {
        const passwordInput = document.getElementById('password');
        const toggleButton = document.getElementById('togglePassword');
        if (passwordInput && toggleButton) {
            const isShowing = toggleButton.getAttribute('data-showing') === 'true';
            const newType = isShowing ? 'password' : 'text';
            const newIcon = isShowing ? 'fas fa-eye' : 'fas fa-eye-slash';
            passwordInput.setAttribute('type', newType);
            toggleButton.setAttribute('data-showing', !isShowing);
            toggleButton.querySelector('i').className = newIcon;
        }
    }

    function togglePasswordConfirm() {
        const passwordInput = document.getElementById('passwordConfirm');
        const toggleButton = document.getElementById('togglePasswordConfirm');
        if (passwordInput && toggleButton) {
            const isShowing = toggleButton.getAttribute('data-showing') === 'true';
            const newType = isShowing ? 'password' : 'text';
            const newIcon = isShowing ? 'fas fa-eye' : 'fas fa-eye-slash';
            passwordInput.setAttribute('type', newType);
            toggleButton.setAttribute('data-showing', !isShowing);
            toggleButton.querySelector('i').className = newIcon;
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const toggleButton = document.getElementById('togglePassword');
        if (toggleButton) {
            toggleButton.addEventListener('click', togglePassword);
        }
        const toggleConfirmButton = document.getElementById('togglePasswordConfirm');
        if (toggleConfirmButton) {
            toggleConfirmButton.addEventListener('click', togglePasswordConfirm);
        }
    });
</script>
</body>
</html>
