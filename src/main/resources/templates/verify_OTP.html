<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="_csrf" th:content="${_csrf.token}" th:if="${_csrf}">
    <title>X√°c th·ª±c OTP - MoonCinema</title>
    <link rel="apple-touch-icon" sizes="180x180" th:href="@{/favicon/apple-touch-icon.png}">
    <link rel="icon" type="image/png" sizes="32x32" th:href="@{/favicon/favicon-32x32.png}">
    <link rel="icon" type="image/png" sizes="16x16" th:href="@{/favicon/favicon-16x16.png}">
    <link rel="manifest" th:href="@{/favicon/site.webmanifest}">
    <link rel="icon" type="image/x-icon" th:href="@{/favicon/favicon.ico}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/otp-verify.css}">
</head>
<body class="otp-page">
<div class="otp-container">
    <div class="otp-header">
        <div class="otp-logo-icon">üé¨</div>
        <h1>MoonCinema</h1>
        <p class="otp-instruction">X√°c th·ª±c t√†i kho·∫£n</p>
    </div>

    <div th:if="${error}" class="alert alert-danger otp-alert" role="alert">
        <i class="fas fa-exclamation-triangle"></i>
        <span th:text="${error}">M√£ OTP kh√¥ng ƒë√∫ng ho·∫∑c ƒë√£ h·∫øt h·∫°n!</span>
    </div>

    <div th:if="${errorOTP}" class="alert alert-danger otp-alert" role="alert">
        <i class="fas fa-exclamation-triangle"></i>
        <span th:text="${errorOTP}">M√£ OTP kh√¥ng ƒë√∫ng ho·∫∑c ƒë√£ h·∫øt h·∫°n!</span>
    </div>

    <div th:if="${info}" class="alert alert-info otp-alert" role="alert">
        <i class="fas fa-info-circle"></i>
        <span th:text="${info}">M√£ OTP m·ªõi ƒë√£ ƒë∆∞·ª£c g·ª≠i!</span>
    </div>

    <form id="otpForm" method="post" th:action="@{/verifyOTP}">
        <input type="hidden" name="_csrf" th:value="${_csrf.token}" th:if="${_csrf}">
        <input type="hidden" name="email" th:value="${email}">

        <div class="otp-input-group">
            <input type="text" class="otp-input" maxlength="1" id="otp1" name="otp1" autocomplete="off">
            <input type="text" class="otp-input" maxlength="1" id="otp2" name="otp2" autocomplete="off">
            <input type="text" class="otp-input" maxlength="1" id="otp3" name="otp3" autocomplete="off">
            <input type="text" class="otp-input" maxlength="1" id="otp4" name="otp4" autocomplete="off">
            <input type="text" class="otp-input" maxlength="1" id="otp5" name="otp5" autocomplete="off">
            <input type="text" class="otp-input" maxlength="1" id="otp6" name="otp6" autocomplete="off">
        </div>

        <input type="hidden" name="otpCode" id="otpCode">
        <input type="hidden" name="OTPinput" id="OTPinput">

        <div class="otp-timer-section">
            <div class="otp-timer" id="timer">
                <i class="fas fa-clock"></i>
                M√£ s·∫Ω h·∫øt h·∫°n sau: <span id="countdown">05:00</span>
            </div>
        </div>

        <button type="submit" class="btn-verify-otp" id="verifyBtn" disabled>
            <span class="btn-text">Nh·∫≠p m√£ OTP</span>
        </button>

        <div class="text-center">
            <p style="color: #6b7280; margin-bottom: 10px;">Kh√¥ng nh·∫≠n ƒë∆∞·ª£c m√£?</p>
            <a href="#" class="btn-resend-otp" id="resendBtn">
                <i class="fas fa-redo"></i> G·ª≠i l·∫°i m√£
            </a>
        </div>

        <!-- Back to Login -->
        <div class="text-center mt-3">
            <p style="color: #6b7280; margin-bottom: 10px;">Quay l·∫°i trang ƒëƒÉng nh·∫≠p?</p>
            <a href="/auth" class="btn-back-login">
                <i class="fas fa-arrow-left me-1"></i> V·ªÅ trang ƒëƒÉng nh·∫≠p
            </a>
        </div>
    </form>

    <div class="otp-help-section">
        <p><strong>C·∫ßn h·ªó tr·ª£?</strong></p>
        <p>
            Li√™n h·ªá: <a href="mailto:support@mooncinema.com">support@mooncinema.com</a><br>
            Ho·∫∑c g·ªçi: <a href="tel:1900-123-456">1900-123-456</a>
        </p>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/otp-verify.js}"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const otpInputs = document.querySelectorAll(".otp-input");
        const otpHiddenInput = document.getElementById("OTPinput");
        const verifyBtn = document.getElementById("verifyBtn");

        otpInputs.forEach((input, index) => {
            input.addEventListener("input", () => {
                // T·ª± ƒë·ªông chuy·ªÉn sang √¥ ti·∫øp theo khi nh·∫≠p
                if (input.value.length === 1 && index < otpInputs.length - 1) {
                    otpInputs[index + 1].focus();
                }

                updateOTPValue();
            });

            input.addEventListener("keydown", (e) => {
                // Di chuy·ªÉn sang √¥ tr∆∞·ªõc khi nh·∫•n Backspace
                if (e.key === "Backspace" && input.value === "" && index > 0) {
                    otpInputs[index - 1].focus();
                }
            });
        });

        function updateOTPValue() {
            const otpCode = Array.from(otpInputs)
                .map(input => input.value.trim())
                .join("");

            otpHiddenInput.value = otpCode;

            // K√≠ch ho·∫°t n√∫t x√°c nh·∫≠n n·∫øu ƒë√£ nh·∫≠p ƒë·ªß 6 k√Ω t·ª±
            verifyBtn.disabled = otpCode.length !== 6;
        }
    });
</script>
</body>
</html>

