<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layoutAdmin}">
<head>
    <title>Lịch suất chiếu</title>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet"/>
    <link rel="stylesheet" th:href="@{/css/admin/showtime/crud-showtime.css}" />
    <link rel="apple-touch-icon" sizes="180x180" th:href="@{/favicon/apple-touch-icon.png}">
    <link rel="icon" type="image/png" sizes="32x32" th:href="@{/favicon/favicon-32x32.png}">
    <link rel="icon" type="image/png" sizes="16x16" th:href="@{/favicon/favicon-16x16.png}">
    <link rel="manifest" th:href="@{/favicon/site.webmanifest}">
    <link rel="icon" type="image/x-icon" th:href="@{/favicon/favicon.ico}">

</head>
<body>
<div layout:fragment="header">
    <div th:replace="~{fragments/title_admin :: header('Danh sách suất chiếu', 'bi-person-badge')}"></div>
</div>
<div layout:fragment="content">
    <div class="container">
        <a th:href="@{/admin/showtime/statistics}" class="btn-stats">Xem thống kê suất chiếu</a>
        <button type="button" class="btn-create-showtime" data-bs-toggle="modal" data-bs-target="#autoCreateShowtimeModal">
            Tạo suất chiếu tự động
        </button>
        <button type="button" class="btn-delete-date" data-bs-toggle="modal"
                data-bs-target="#deleteShowtimesByDateModal" >Xóa suất chiếu theo ngày
        </button>
        <div th:if="${error}" th:text="${error}" class="alert alert-danger"></div>
        <div th:if="${success}" th:text="${success}" class="alert alert-success"></div>

        <form th:action="@{/admin/showtime}" method="get" class="form-group">
            <div class="form-group-room">
                <label>Chọn phòng:</label>
                <select name="roomId">
                    <option value="">Tất cả phòng</option>
                    <option th:each="room : ${rooms}" th:value="${room.roomId}"
                            th:text="${room.roomName}" th:selected="${room.roomId == selectedRoomId}"></option>
                </select>
            </div>
            <div class="form-group-watch">
                <label>Chế độ xem:</label>
                <select name="viewType" class="view-type">
                    <option value="week" th:selected="${viewType == 'week'}">Tuần</option>
                    <option value="month" th:selected="${viewType == 'month'}">Tháng</option>
                </select>
            </div>

            <input type="hidden" name="startDate" th:value="${startDate}"/>
            <input type="hidden" name="endDate" th:value="${endDate}"/>
            <button type="submit" class="btn">Xem</button>
        </form>

        <div class="calendar-container">
            <div id="calendar"></div>
        </div>

        <div class="modal fade" id="createShowtimeModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Thêm suất chiếu</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form th:action="@{/admin/showtime/create}" th:object="${showtimeRequest}" method="post"
                              id="createShowtimeForm">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <label>Ngày chiếu:</label>
                            <input type="date" th:field="*{showDate}" id="showDate" required/>
                            <label>Giờ chiếu:</label>
                            <input type="time" th:field="*{scheduleTime}" id="scheduleTime" step="300" min="08:00"
                                   max="23:00" required/>
                            <label>Phim:</label>
                            <select th:field="*{movieId}" id="movieId" required>
                                <option value="">Chọn phim</option>
                                <option th:each="movie : ${movies}" th:value="${movie.movieId}"
                                        th:text="${movie.movieName}"></option>
                            </select>
                            <label>Phòng chiếu:</label>
                            <select th:field="*{roomId}" id="roomId" required>
                                <option value="">Chọn phòng</option>
                                <option th:each="room : ${rooms}" th:value="${room.roomId}"
                                        th:text="${room.roomName}"></option>
                            </select>
                            <label>Phiên bản:</label>
                            <select th:field="*{versionId}" id="versionId" required>
                                <option value="">Chọn phiên bản</option>
                            </select>
                            <button type="button" class="btn btn-suggest" id="suggestTimeBtn">Gợi ý giờ</button>
                            <button type="button" class="btn btn-submit" id="confirmSubmitBtn">Thêm</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="autoCreateShowtimeModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Tạo suất chiếu tự động</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="autoCreateShowtimeForm">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <label>Ngày chiếu:</label>
                            <input type="date" id="autoShowDate" required/>
                            <label>Phòng chiếu:</label>
                            <select id="autoRoomId" required>
                                <option value="">Chọn phòng</option>
                                <option th:each="room : ${rooms}" th:value="${room.roomId}"
                                        th:text="${room.roomName}"></option>
                            </select>
                            <div class="movie-entries-container">
                                <div class="movie-entry">
                                    <select class="autoMovieId" required>
                                        <option value="">Chọn phim</option>
                                        <option th:each="movie : ${movies}" th:value="${movie.movieId}"
                                                th:text="${movie.movieName}"></option>
                                    </select>
                                    <select class="autoVersionId" required>
                                        <option value="">Chọn phiên bản</option>
                                    </select>
                                    <input type="number" class="autoShowtimeCount" min="1" max="5" value="1" required/>
                                    <span class="remove-movie-btn" style="display:none;">X</span>
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary" id="addMovieBtn">Thêm phim</button>
                            <button type="button" id="autoConfirmBtn">Tạo</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="autoConfirmModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Xác nhận suất chiếu tự động</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p id="autoConfirmDetails"></p>
                        <button type="button" class="btn btn-submit" id="autoFinalConfirmBtn">Xác nhận</button>
                        <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">Hủy</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade confirm-modal" id="confirmModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Xác nhận suất chiếu</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p id="confirmDetails"></p>
                        <button type="button" class="btn btn-submit" id="finalConfirmBtn">Xác nhận</button>
                        <button type="button" class="btn btn-cancel-modal" data-bs-dismiss="modal">Hủy</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="deleteShowtimesByDateModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Xóa suất chiếu theo ngày và phòng</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form th:action="@{/admin/showtime/delete-by-date-and-room}" method="post"
                              id="deleteShowtimesByDateForm">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <label>Chọn ngày để xóa suất chiếu:</label>
                            <input type="date" name="showDate" id="deleteShowDate" required/>
                            <label>Chọn phòng để xóa suất chiếu:</label>
                            <select name="roomId" id="deleteRoomId" required>
                                <option value="">Chọn phòng</option>
                                <option th:each="room : ${rooms}" th:value="${room.roomId}" th:text="${room.roomName}"></option>
                            </select>
                            <input type="hidden" name="startDate" th:value="${startDate}"/>
                            <input type="hidden" name="endDate" th:value="${endDate}"/>
                            <input type="hidden" name="viewType" th:value="${viewType}"/>
                            <input type="hidden" name="selectedRoomId" th:value="${selectedRoomId}"/>
                            <button type="button" class="btn btn-danger" id="confirmDeleteByDateBtn">Xóa</button>
                            <button type="button" class="btn btn-cancel-modal" data-bs-dismiss="modal">Hủy</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- nó đỏ v thoi chứ chạy bth đừng đụng vô-->
    <script th:inline="javascript">
        window.appData = {
            movies: /*[[${movies}]]*/,
            selectedRoomId: /*[[${selectedRoomId}]]*/,
            viewType: /*[[${viewType}]]*/,
            startDate: /*[[${startDate}]]*/,
            endDate: /*[[${endDate}]]*/,
            initialDate: /*[[${initialDate}]]*/,
            _csrf:/*[[${_csrf.token}]]*/
        };
    </script>
    <script th:src="@{/js/showTimeAdmin.js}"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</div>

</body>
</html>
